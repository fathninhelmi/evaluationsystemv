<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="./style.css">

<title>Post Evaluation Form</title>
<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0/dist/iife/sdk.js"></script>
</head>

<body>
<header class="header">
    <a href="#" class="logo"><img src="logo.png" alt="logo"></a>
</header>

<div class="card-eval">

<!-- ================= HEADER ================= -->
<div class="form-header">
    <button type="button" class="back-icon-btn" onclick="goBack()">
        ←
    </button>
    <h1 id="formTitle">Post Evaluation Form</h1>
    <span id="statusBadge" class="status-badge"></span>
</div>

<div id="loadingIndicator" class="loading" style="display:none;">Loading form data</div>

<form id="postEvalForm" style="display:none;">

<!-- ================= WIN / LOSE ================= -->
<div class="form-section">
    <div class="section-title">Win / Lose</div>

    <div class="result-buttons">
        <button type="button" class="result-btn" data-result="win">Win</button>
        <button type="button" class="result-btn" data-result="pending">Pending</button>
        <button type="button" class="result-btn" data-result="lose">Lose</button>
    </div>

    <input type="hidden" id="result" name="result">

    <!-- WIN -->
    <div id="winReasonSection" style="display:none;margin-top:20px;">
        <label><strong>Reasons for Win</strong></label>
        <label><input type="checkbox" name="winReason" value="Global_Standardization_Strategy"> Global Standardization</label>
        <label><input type="checkbox" name="winReason" value="Strong_Existing_Relationship"> Strong Relationship</label>
        <label><input type="checkbox" name="winReason" value="Lowest_Total_Cost_of_Ownership"> Lowest TCO</label>
        <label><input type="checkbox" name="winReason" value="Superior_Technical_Performance"> Technical Performance</label>
        <label><input type="checkbox" name="winReason" value="Superior_UI_UX"> UI / UX</label>
        <label><input type="checkbox" name="winReason" value="others"> Others</label>

        <div id="otherWinReasonSection" style="display:none;margin-top:10px;">
            <textarea id="otherwinReason" placeholder="Specify other win reason"></textarea>
        </div>
    </div>

    <!-- LOSE -->
    <div id="loseReasonSection" style="display:none;margin-top:20px;">
        <label><strong>Reasons for Lose</strong></label>
        <label><input type="checkbox" name="loseReason" value="Technical_Requirements_Not_Met"> Technical</label>
        <label><input type="checkbox" name="loseReason" value="Lead_Time_Mismatch"> Lead Time</label>
        <label><input type="checkbox" name="loseReason" value="Costs"> Cost</label>
        <label><input type="checkbox" name="loseReason" value="Advance_Features"> Advance Features</label>
        <label><input type="checkbox" name="loseReason" value="others"> Others</label>

        <div id="otherLoseReasonSection" style="display:none;margin-top:10px;">
            <textarea id="otherloseReason" placeholder="Specify other lose reason"></textarea>
        </div>
    </div>
</div>

<!-- ================= KEYWORD ================= -->
<div class="form-section">
    <div class="section-title">Keyword</div>

    <table class="eval-table">
        <tbody id="keywordTableBody">
            <tr>
                <td class="row-number">1</td>
                <td>
                    <input type="text" name="keyword_1" class="table-input">
                    <button type="button" onclick="deleteKeywordRow(this)" style="display:none;">×</button>
                </td>
            </tr>
        </tbody>
    </table>

    <button type="button" onclick="addKeywordRow()">+ Add Keyword</button>
</div>

<!-- ================= ATTACHMENT ================= -->
<div class="form-section">
    <div class="section-title">Attachment</div>
    <input type="file" id="attachmentInput" accept=".png,.pdf">
    <div id="attachmentPreview"></div>
</div>

<!-- ================= ACTIONS ================= -->
<div class="form-actions">
    <button type="button" class="btn btn-danger" onclick="dropForm()">Drop</button>
    <button type="button" class="btn btn-primary" onclick="saveForm('draft')">Save as Draft</button>
    <button type="submit" class="btn btn-success">Submit</button>
</div>

</form>
</div>

<!-- ================= SCRIPT ================= -->
<script>
function validateForm(status){
    if(status !== "complete") return {};
    
    const result = document.getElementById("result").value;
    if(!result){
        alert("Please select Win / Lose / Pending");
        return false;
    }

    const keywords = [...document.querySelectorAll('[name^="keyword_"]')]
        .map(i=>i.value.trim()).filter(Boolean);

    if(keywords.length === 0){
        alert("At least one keyword required");
        return false;
    }

    return { keyword: keywords, result };
}

async function saveForm(status){
    const validation = validateForm(status);
    if(validation === false) return;

    alert(status === "draft" ? "Draft saved" : "Form submitted");
}

function addKeywordRow(){
    const tbody = document.getElementById("keywordTableBody");
    const index = tbody.children.length + 1;
    const row = document.createElement("tr");
    row.innerHTML = `
        <td>${index}</td>
        <td>
            <input type="text" name="keyword_${index}">
            <button onclick="deleteKeywordRow(this)">×</button>
        </td>`;
    tbody.appendChild(row);
}

function deleteKeywordRow(btn){
    const tbody = document.getElementById("keywordTableBody");
    if(tbody.children.length <= 1) return;
    btn.closest("tr").remove();
}

document.getElementById("postEvalForm").addEventListener("submit", e=>{
    e.preventDefault();
    saveForm("complete");
});

function goBack(){ history.back(); }
document.addEventListener("DOMContentLoaded", ()=> {
    document.getElementById("postEvalForm").style.display = "block";
});
</script>

<footer class="footer">
    © 2025 ViTrox
</footer>
</body>
</html>
